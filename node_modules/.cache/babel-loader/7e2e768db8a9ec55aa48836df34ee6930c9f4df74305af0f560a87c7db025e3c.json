{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst react_1 = require(\"react\");\nconst useCompleteRequest_1 = __importDefault(require(\"./useCompleteRequest\"));\nconst useInitiateRequest_1 = __importDefault(require(\"./useInitiateRequest\"));\nconst presentation_definitions_1 = require(\"../utils/presentation-definitions\");\nfunction useInitiateEmailRequest({\n  callbackUrl,\n  doVerification,\n  useVerifyVpMutation\n}) {\n  const [data, setData] = (0, react_1.useState)();\n  const vaultRequest = {\n    presentationDefinition: presentation_definitions_1.presentationDefinitions.emailVc,\n    callbackUrl,\n    doVerification,\n    useVerifyVpMutation\n  };\n  const {\n    isInitializing,\n    isExtensionInstalled,\n    handleInitiate\n  } = (0, useInitiateRequest_1.default)(vaultRequest);\n  const {\n    vpToken,\n    error,\n    errorDescription,\n    isLoading,\n    isCompliant\n  } = (0, useCompleteRequest_1.default)(vaultRequest);\n  (0, react_1.useEffect)(() => {\n    if (vpToken && !isLoading && isCompliant) {\n      const emailVC = vpToken.verifiableCredential.find(vc => vc.type.indexOf('Email') > -1);\n      if (emailVC) {\n        const credentialSubject = Array.isArray(emailVC.credentialSubject) ? emailVC.credentialSubject[0] : emailVC.credentialSubject;\n        setData(state => ({\n          ...state,\n          ...credentialSubject\n        }));\n      }\n    }\n  }, [vpToken, isLoading, isCompliant]);\n  return {\n    isInitializing,\n    isExtensionInstalled,\n    handleInitiate,\n    isLoading: vpToken && isLoading,\n    error,\n    errorDescription,\n    profileData: data\n  };\n}\nexports.default = useInitiateEmailRequest;","map":{"version":3,"names":["react_1","require","useCompleteRequest_1","__importDefault","useInitiateRequest_1","presentation_definitions_1","useInitiateEmailRequest","callbackUrl","doVerification","useVerifyVpMutation","data","setData","useState","vaultRequest","presentationDefinition","presentationDefinitions","emailVc","isInitializing","isExtensionInstalled","handleInitiate","default","vpToken","error","errorDescription","isLoading","isCompliant","useEffect","emailVC","verifiableCredential","find","vc","type","indexOf","credentialSubject","Array","isArray","state","profileData","exports"],"sources":["../../src/hooks/useInitiateEmailRequest.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;AAAA,MAAAA,OAAA,GAAAC,OAAA;AACA,MAAAC,oBAAA,GAAAC,eAAA,CAAAF,OAAA;AACA,MAAAG,oBAAA,GAAAD,eAAA,CAAAF,OAAA;AACA,MAAAI,0BAAA,GAAAJ,OAAA;AAMA,SAAwBK,uBAAuBA,CAAC;EAC9CC,WAAW;EACXC,cAAc;EACdC;AAAmB,CACF;EACjB,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAG,IAAAX,OAAA,CAAAY,QAAQ,GAAkB;EAGlD,MAAMC,YAAY,GAAqB;IACrCC,sBAAsB,EAAET,0BAAA,CAAAU,uBAAuB,CAACC,OAAO;IACvDT,WAAW;IACXC,cAAc;IACdC;GACD;EAGD,MAAM;IAAEQ,cAAc;IAAEC,oBAAoB;IAAEC;EAAc,CAAE,GAAG,IAAAf,oBAAA,CAAAgB,OAAkB,EAACP,YAAY,CAAC;EAGjG,MAAM;IAAEQ,OAAO;IAAEC,KAAK;IAAEC,gBAAgB;IAAEC,SAAS;IAAEC;EAAW,CAAE,GAAG,IAAAvB,oBAAA,CAAAkB,OAAkB,EAACP,YAAY,CAAC;EAErG,IAAAb,OAAA,CAAA0B,SAAS,EAAC,MAAK;IACb,IAAIL,OAAO,IAAI,CAACG,SAAS,IAAIC,WAAW,EAAE;MAExC,MAAME,OAAO,GAAGN,OAAO,CAACO,oBAAoB,CAACC,IAAI,CAAEC,EAAO,IAAKA,EAAE,CAACC,IAAI,CAACC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;MAE7F,IAAIL,OAAO,EAAE;QACX,MAAMM,iBAAiB,GAAGC,KAAK,CAACC,OAAO,CAACR,OAAO,CAACM,iBAAiB,CAAC,GAC9DN,OAAO,CAACM,iBAAiB,CAAC,CAAC,CAAC,GAC5BN,OAAO,CAACM,iBAAiB;QAC7BtB,OAAO,CAAEyB,KAAK,KAAM;UAAE,GAAGA,KAAK;UAAE,GAAGH;QAAiB,CAAE,CAAC,CAAC;;;EAG9D,CAAC,EAAE,CAACZ,OAAO,EAAEG,SAAS,EAAEC,WAAW,CAAC,CAAC;EAErC,OAAO;IACLR,cAAc;IACdC,oBAAoB;IACpBC,cAAc;IACdK,SAAS,EAAEH,OAAO,IAAIG,SAAS;IAC/BF,KAAK;IACLC,gBAAgB;IAChBc,WAAW,EAAE3B;GACd;AACH;AA5CA4B,OAAA,CAAAlB,OAAA,GAAAd,uBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}