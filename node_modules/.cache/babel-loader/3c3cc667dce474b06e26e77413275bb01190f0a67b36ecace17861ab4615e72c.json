{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AivExtensionClient = exports.CHROME_EXTENSION_ID = void 0;\nexports.CHROME_EXTENSION_ID = 'fejpjjkbaklcdcibmkbmpanjbiihclon';\nconst INSTALLATION_CHECK_TIMEOUT_MS = 1000;\nclass AivExtensionClient {\n  constructor(input) {\n    var _a;\n    this.chromeExtensionId = (_a = input === null || input === void 0 ? void 0 : input.chromeExtensionId) !== null && _a !== void 0 ? _a : exports.CHROME_EXTENSION_ID;\n  }\n  isInstalled() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return new Promise(resolve => {\n        let image;\n        let timeoutId;\n        const respond = result => {\n          if (timeoutId) clearTimeout(timeoutId);\n          if (image) image.src = '';\n          resolve(result);\n        };\n        timeoutId = window.setTimeout(() => respond(false), INSTALLATION_CHECK_TIMEOUT_MS);\n        image = window.document.createElement('img');\n        image.onload = () => respond(true);\n        image.onerror = () => respond(false);\n        image.src = `chrome-extension://${this.chromeExtensionId}/stub.png`;\n      });\n    });\n  }\n  getOidc4vpAuthorizationUrl() {\n    return `chrome-extension://${this.chromeExtensionId}/login.html`;\n  }\n  getChromeWebStoreUrl() {\n    return `https://chrome.google.com/webstore/detail/${this.chromeExtensionId}`;\n  }\n  initiateAuth({\n    responseDestination,\n    presentationDefinition,\n    state,\n    nonce\n  }) {\n    const url = new URL(this.getOidc4vpAuthorizationUrl());\n    if (responseDestination.responseMode === 'direct_post') {\n      url.searchParams.set('response_mode', 'direct_post');\n      url.searchParams.set('response_uri', responseDestination.responseUri);\n    } else {\n      url.searchParams.set('response_mode', 'query');\n      url.searchParams.set('redirect_uri', responseDestination.redirectUri);\n    }\n    url.searchParams.set('response_type', 'vp_token');\n    url.searchParams.set('scope', 'openid');\n    url.searchParams.set('claims', JSON.stringify({\n      vp_token: {\n        presentation_definition: presentationDefinition\n      }\n    }));\n    url.searchParams.set('state', state);\n    url.searchParams.set('nonce', nonce);\n    window.location.href = url.toString();\n  }\n  completeAuth(url) {\n    const urlObject = new URL(url);\n    const params = new URLSearchParams(urlObject.search);\n    const state = params.get('state');\n    if (!state) {\n      throw new Error('State is not present in the response');\n    }\n    const error = params.get('error');\n    const errorDescription = params.get('error_description') || undefined;\n    if (error) {\n      return {\n        state,\n        error,\n        errorDescription\n      };\n    }\n    const serializedVpToken = params.get('vp_token');\n    const idToken = params.get('id_token') || undefined;\n    const serializedPresentationSubmission = params.get('presentation_submission');\n    if (!serializedVpToken || !serializedPresentationSubmission) {\n      throw new Error('Some query parameters are missing in the response');\n    }\n    return {\n      state,\n      idToken,\n      vpToken: JSON.parse(serializedVpToken),\n      presentationSubmission: JSON.parse(serializedPresentationSubmission)\n    };\n  }\n  getVersion() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return new Promise(resolve => {\n        if (!(chrome === null || chrome === void 0 ? void 0 : chrome.runtime)) resolve(undefined);\n        const message = {\n          type: 'version'\n        };\n        chrome.runtime.sendMessage(this.chromeExtensionId, message, response => {\n          if (chrome.runtime.lastError) {\n            resolve(undefined);\n          }\n          resolve(response === null || response === void 0 ? void 0 : response.version);\n        });\n      });\n    });\n  }\n}\nexports.AivExtensionClient = AivExtensionClient;","map":{"version":3,"names":["exports","CHROME_EXTENSION_ID","INSTALLATION_CHECK_TIMEOUT_MS","AivExtensionClient","constructor","input","chromeExtensionId","_a","isInstalled","Promise","resolve","image","timeoutId","respond","result","clearTimeout","src","window","setTimeout","document","createElement","onload","onerror","getOidc4vpAuthorizationUrl","getChromeWebStoreUrl","initiateAuth","responseDestination","presentationDefinition","state","nonce","url","URL","responseMode","searchParams","set","responseUri","redirectUri","JSON","stringify","vp_token","presentation_definition","location","href","toString","completeAuth","urlObject","params","URLSearchParams","search","get","Error","error","errorDescription","undefined","serializedVpToken","idToken","serializedPresentationSubmission","vpToken","parse","presentationSubmission","getVersion","chrome","runtime","message","type","sendMessage","response","lastError","version"],"sources":["../src/aiv-extension-client.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}