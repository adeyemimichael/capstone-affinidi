{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst react_1 = require(\"react\");\nconst useExtension_1 = require(\"./useExtension\");\nconst types_1 = require(\"../types\");\nfunction useCompleteRequest({\n  presentationDefinition,\n  callbackUrl,\n  doVerification = true,\n  useVerifyVpMutation\n}) {\n  const {\n    client\n  } = (0, useExtension_1.useExtension)();\n  const [error, setError] = (0, react_1.useState)();\n  const [errorDescription, setErrorDescription] = (0, react_1.useState)();\n  const [vpToken, setVpToken] = (0, react_1.useState)();\n  const [presentationSubmission, setPresentationSubmission] = (0, react_1.useState)();\n  const {\n    mutate,\n    ...mutation\n  } = useVerifyVpMutation && useVerifyVpMutation() || {};\n  (0, react_1.useEffect)(() => {\n    if (window.location.href.indexOf(callbackUrl) == -1) return;\n    try {\n      const response = client.completeAuth(window.location.href);\n      if ('error' in response) {\n        setError(types_1.errorMessageMap[response.error] || 'Unexpected error');\n        setErrorDescription(response.errorDescription && types_1.errorDescriptionMessageMap[response.errorDescription] || undefined);\n        return;\n      } else {\n        setVpToken(response.vpToken);\n        setPresentationSubmission(response.presentationSubmission);\n      }\n    } catch (err) {\n      setError(err.messsage || 'Unexpected error');\n    }\n  }, [client, setVpToken, setPresentationSubmission]);\n  (0, react_1.useEffect)(() => {\n    if (doVerification && mutation && mutation.error) {\n      setVpToken(undefined);\n      setPresentationSubmission(undefined);\n      setError('Could not verify your data');\n      setErrorDescription(mutation.error.message);\n    }\n  }, [mutation.error]);\n  (0, react_1.useEffect)(() => {\n    if (vpToken && doVerification && mutate) {\n      mutate({\n        verifiablePresentation: vpToken,\n        presentationSubmission,\n        presentationDefinition\n      });\n    }\n  }, [vpToken, presentationSubmission, mutate]);\n  return {\n    vpToken,\n    presentationSubmission,\n    error,\n    errorDescription,\n    isLoading: doVerification ? mutation.isIdle || mutation.isLoading : false,\n    isCompliant: doVerification ? Boolean(mutation.data?.isCompliant) : true\n  };\n}\nexports.default = useCompleteRequest;","map":{"version":3,"names":["react_1","require","useExtension_1","types_1","useCompleteRequest","presentationDefinition","callbackUrl","doVerification","useVerifyVpMutation","client","useExtension","error","setError","useState","errorDescription","setErrorDescription","vpToken","setVpToken","presentationSubmission","setPresentationSubmission","mutate","mutation","useEffect","window","location","href","indexOf","response","completeAuth","errorMessageMap","errorDescriptionMessageMap","undefined","err","messsage","message","verifiablePresentation","isLoading","isIdle","isCompliant","Boolean","data","exports","default"],"sources":["../../src/hooks/useCompleteRequest.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}