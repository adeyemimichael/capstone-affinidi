{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst react_1 = require(\"react\");\nconst types_1 = require(\"../types\");\nconst storageKey = 'affinidi-login';\nconst getStorgageData = () => {\n  const data = window.localStorage.getItem(storageKey);\n  return data ? JSON.parse(data) : undefined;\n};\nconst setStorgageData = data => {\n  window.localStorage.setItem(storageKey, JSON.stringify(data));\n  return data;\n};\nconst clearStorgageData = () => {\n  window.localStorage.removeItem(storageKey);\n};\nconst useAffinidiProfile = ({\n  redirectTo = '/',\n  authCompleteUrl = '/api/affinidi-auth/complete'\n} = {}) => {\n  const [isLoading, setIsLoading] = (0, react_1.useState)(false);\n  const [code, setCode] = (0, react_1.useState)(undefined);\n  const [state, setState] = (0, react_1.useState)(null);\n  (0, react_1.useEffect)(() => {\n    const urlObject = new URL(window.location.href);\n    const params = new URLSearchParams(urlObject.search);\n    const pCode = params.get('code');\n    const perror = params.get('error');\n    if (pCode) {\n      setCode(pCode);\n      setState(params.get('state'));\n    } else if (perror) {\n      const errorDescription = params.get('error_description') || '';\n      setStorgageData({\n        error: `${types_1.errorMessageMap[perror] || 'Unexpected error'} - ${errorDescription && types_1.errorDescriptionMessageMap[errorDescription] || undefined}`\n      });\n      window.location.href = redirectTo;\n    }\n  }, []);\n  (0, react_1.useEffect)(() => {\n    if (!code) {\n      return;\n    }\n    const getProfile = async params => {\n      setIsLoading(true);\n      const res = await fetch(authCompleteUrl, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(params)\n      });\n      const response = await res.json();\n      if (response.error) {\n        setStorgageData({\n          error: `${response.error}-${response.error_description}`\n        });\n      } else {\n        setStorgageData({\n          profile: response.user\n        });\n      }\n      setIsLoading(false);\n      window.location.href = redirectTo;\n    };\n    const params = {\n      code,\n      state\n    };\n    getProfile(params);\n  }, [code, state]);\n  async function handleLogout() {\n    clearStorgageData();\n  }\n  return {\n    handleLogout,\n    isLoading,\n    ...getStorgageData()\n  };\n};\nexports.default = useAffinidiProfile;","map":{"version":3,"names":["react_1","require","types_1","storageKey","getStorgageData","data","window","localStorage","getItem","JSON","parse","undefined","setStorgageData","setItem","stringify","clearStorgageData","removeItem","useAffinidiProfile","redirectTo","authCompleteUrl","isLoading","setIsLoading","useState","code","setCode","state","setState","useEffect","urlObject","URL","location","href","params","URLSearchParams","search","pCode","get","perror","errorDescription","error","errorMessageMap","errorDescriptionMessageMap","getProfile","res","fetch","method","headers","body","response","json","error_description","profile","user","handleLogout","exports","default"],"sources":["../../src/hooks/useAffinidiProfile.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}